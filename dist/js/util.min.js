"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Util=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"each",value:function(t,e){for(var n in t){var i=t[n];e(n,i)}}}]),t}();if("undefined"==typeof isDefined&&(window.isDefined=function(t){return"undefined"!=typeof t}),"undefined"==typeof isNull&&(window.isNull=function(t){return null===t}),"undefined"==typeof isFunction&&(window.isFunction=function(t){return"function"==typeof t}),"undefined"==typeof isString&&(window.isString=function(t){return"string"==typeof t}),"undefined"==typeof isNumber&&(window.isNumber=function(t){return"number"==typeof t}),"undefined"==typeof isObject&&(window.isObject=function(t){return null!==t&&"object"===("undefined"==typeof t?"undefined":_typeof(t))}),"undefined"==typeof getType&&(window.getType=function(t){return null===t?"[object Null]":Object.prototype.toString.call(t)}),"undefined"==typeof Array.diff&&(Array.diff=function(t,e){return t.filter(function(t){return e.indexOf(t)<0})}),"undefined"==typeof Array.min&&(Array.min=function(t){return Math.min.apply(Math,t)}),"undefined"==typeof Array.max&&(Array.max=function(t){return Math.max.apply(Math,t)}),"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");t=Object(t);for(var e=1;e<arguments.length;e++){var n=arguments[e];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}),!isDefined($))throw new ReferenceError("util-jquery requires jquery 2.2.2 or greater");var $Util=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"jQuerify",value:function(e){if(!e.$wrapper)throw new ReferenceError("$Util.jQuerify: $wrapper must be a property of the first argument");Util.each(t.jqueryPrototype,function(t,n){e[n]=function(){var t;return(t=e.$wrapper)[n].apply(t,arguments),e}})}},{key:"opts",value:function(t,e){return $.extend(!0,t,e)}}]),t}();$Util.jqueryPrototype=Object.getOwnPropertyNames($.prototype),$Util.populate={},function(t){t.fn.addToSelect=function(){var e={};arguments.length>1?e[arguments[0]]=arguments[1]:e=arguments[0];var n=t(this);return n.is("select")&&Util.each(e,function(t,e){var i='<option value="'+t+'">'+e+"</option>";n.append(i)}),this},t.fn.hasAttr=function(e){return t(this).is("["+e+"]")},t.fn.populate=function(e){function n(t,e,n){switch(t){case"input":r(e,n);break;case"select":case"textarea":s.val(n);break;case"img":s.attr("src",n);break;case"button":s.prop("disabled",0===n);break;default:s.html(n)}}function i(t){return $Util.populate[t]?$Util.populate[t]:s.hasAttr("data-tag")?$Util.populate[s.attr("data-tag")]:null}function r(t,e){switch(t){case"checkbox":var n=s.data("checked");e.toString()!==n&&"1"!==e.toString()&&e!==!0||s.prop("checked",!0);break;case"radio":e===s.attr("value")&&s.prop("checked",!0);break;default:s.val(e)}}var s=t(this),o=s.prop("tagName").toLowerCase(),a=s.attr("type"),u=i(o);return u?u.call(this,e):n(o,a,e),this},t.fn.populateChildren=function(e){var n=t(this);return Util.each(e,function(t,e){var i=n.find('[name="'+t+'"]');0===i.length&&(i=n.find('[data-name="'+t+'"]')),i.length>0&&i.data("populate")!==!1&&i.populate(e)}),this},t.fn.slideToggleState=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e?t(this).slideDown(n,i):t(this).slideUp(n,i),this},t.fn.toggleOption=function(){var e=t(this);if(!e.is("select"))return this;var n,i;if(arguments.length>1){i=arguments[0],t.isArray(i)||(i=[i]),n=arguments[1];for(var r=0;r<i.length;r++)e.find('option[value="'+i[r]+'"]').prop("disabled",!n)}else n=arguments[0],e.find("option").prop("disabled",!n);return this}}(jQuery);var EventSystem=function(){function t(){return _classCallCheck(this,t),this.events={},this}return _createClass(t,[{key:"_create",value:function(t){return this.events[t]={callbacks:[]}}},{key:"_destroy",value:function(t){return isDefined(this.event[t])&&delete this.event[t],this}},{key:"on",value:function(t,e){var n=this.events[t];return isDefined(n)||(n=this._create(t)),n.callbacks.push(e),this}},{key:"off",value:function(t,e){var n=this.events[t];if(isDefined(n)){var i=n.callbacks.indexOf(e);i>-1&&n.callbacks.splice(i,1)}return this}},{key:"offAll",value:function(t){var e=this.events[t];return isDefined(e)&&(e[t].callbacks=[]),this}},{key:"trigger",value:function(){var t=[].shift,e=t.apply(arguments),n=this.events[e];if(!isDefined(n))return this;for(var i=0;i<n.callbacks.length;i++){var r;(r=n.callbacks)[i].apply(r,arguments)}return this}},{key:"emit",value:function(){return this.trigger()}}]),t}();if(!isDefined(EventSystem))throw new ReferenceError("Manager requires EventSystem");var Manager=function(t){function e(t){var n;_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),r={identifier:"id",useObjectNames:!1};return i.settings=Object.assign(r,t),i.objects={},i.count=0,i._cachedData={},n=i,_possibleConstructorReturn(i,n)}return _inherits(e,t),_createClass(e,[{key:"_exists",value:function(){var t=arguments[0];return isString(t)||isNumber(t)?isDefined(this.objects[t]):isDefined(this.objects[t[this.settings.identifier]])}},{key:"_get",value:function(){var t=arguments[0];return isString(t)||isNumber(t)?this.objects[t]:this.objects[t[this.settings.identifier]]}},{key:"_add",value:function(t,e){return this.trigger("add",t),this.count++,isDefined(e)?(t[this.settings.identifier]=e,this.objects[e]=t):this.objects[t[this.settings.identifier]]=t}},{key:"_update",value:function(t,e){return this.trigger("update",t),e?this.objects[e]=t:this.objects[t[this.settings.identifier]]=t}},{key:"_delete",value:function(){var t=arguments[0];if(isString(t)||isNumber(t))String(t),this.objects[t]&&delete this.objects[t];else{if(!this.objects[t[this.settings.id]])return this;delete this.objects[t[this.settings.id]]}return this.count--,this.trigger("delete",arguments[0]),this}},{key:"_empty",value:function(){for(var t in this.objects)delete this.objects[t];return this}},{key:"_cacheData",value:function(t){return this._cachedData=Object.create(t),this}},{key:"_processData",value:function(t){return t}},{key:"getIds",value:function(){var t=[];for(var e in this.objects)t.push(e);return t}},{key:"getId",value:function(t){return t[this.settings.identifier]}},{key:"manage",value:function(t){if(t=this._processData(t),!isObject(t)&&this.settings.useObjectNames)throw new Error("Manager.manage: to use option useObjectNames, object passed to manage() must be an object.");var e=this,n=this.settings.identifier,i=[];for(var r in t){var s=t[r];if(this.settings.useObjectNames&&(s[n]=r),!isDefined(s[n]))return console.error("Manager.manage: cannot manage objects with no ids");var o=s[n].toString(),a=e.objects[o];isDefined(a)?e._update(s):e._add(s),i.push(o)}var u=this.getIds(),c=Array.diff(u,i);for(r=0;r<c.length;r++)this._delete(c[r]);return this}},{key:"exists",value:function(){return this._exists.apply(this,arguments)}},{key:"addObjects",value:function(){var t=arguments.length>1?[].slice.call(arguments).sort():arguments[0];for(var e in t){var n=t[e];this.addObject(n)}return this}},{key:"addObject",value:function(){return this._add.apply(this,arguments)}},{key:"getObject",value:function(){return this._get.apply(this,arguments)}},{key:"updateObject",value:function(){return this._update.apply(this,arguments)}},{key:"deleteObject",value:function(){return this._delete.apply(this,arguments)}},{key:"deleteObjects",value:function(){return this._empty()}},{key:"serializer",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,[]);return Util.each(this.objects,function(e,n){n.toObject&&t.push(n.toObject())}),{objects:t}}}]),e}(EventSystem),Pool=function(){function t(e){return _classCallCheck(this,t),this.object=e,this.totalAlloc=0,this.totalFree=0,this.pool=[],this}return _createClass(t,[{key:"_clearStats",value:function(){var t=this.totalAlloc-this.totalFree;return this.totalAlloc=t||0,this.totalFree=0,this}},{key:"alloc",value:function(){var t;return 0===this.pool.length?(t=new this.object,this.totalAlloc++):(t=this.pool.pop(),this.totalFree--),t}},{key:"free",value:function(t){return this.pool.push(t),this.totalFree++,this}},{key:"collect",value:function(){return this.pool=[],this._clearStats(),this}}]),t}();